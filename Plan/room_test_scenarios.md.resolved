# ğŸ§ª ROOM FEATURE TEST SCENARIOS

**Date:** 2026-01-15  
**Status:** Ready for Testing  
**Features:** CREATE, JOIN, LEAVE, KICK, READY, SET_RULES

---

## ğŸ“‹ TEST CASE 1: CREATE ROOM

### Má»¥c tiÃªu
Verify user cÃ³ thá»ƒ táº¡o phÃ²ng thÃ nh cÃ´ng vÃ  trá»Ÿ thÃ nh host

### Preconditions
- User Ä‘Ã£ Ä‘Äƒng nháº­p
- User Ä‘ang á»Ÿ Lobby

### Steps
1. Click button "Create Room"
2. Nháº­p room name: "Test Room"
3. Chá»n settings: Mode=Scoring, Max Players=6, Wager Mode=Off, Visibility=Public
4. Click "Create"

### Expected Results
- âœ… Room Ä‘Æ°á»£c táº¡o vá»›i code 6 kÃ½ tá»± (vd: "A1B2C3")
- âœ… User Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n WaitingRoom
- âœ… User lÃ  host (cÃ³ nÃºt "Start Game", "Edit Rules", "Kick")
- âœ… Player list hiá»ƒn thá»‹ user vá»›i badge "HOST"
- âœ… Room settings hiá»ƒn thá»‹ Ä‘Ãºng

### Backend Logs
```
[SERVER] [CREATE_ROOM] Request from fd=X
[SERVER] [CREATE_ROOM] âœ… SUCCESS: room_id=X, code=XXXXXX
```

---

## ğŸ“‹ TEST CASE 2A: JOIN ROOM BY CODE

### Má»¥c tiÃªu
Verify user cÃ³ thá»ƒ join phÃ²ng báº±ng room code

### Preconditions
- Room Ä‘Ã£ tá»“n táº¡i (code: "A1B2C3", visibility: Public)
- User Ä‘Ã£ Ä‘Äƒng nháº­p, Ä‘ang á»Ÿ Lobby

### Steps
1. Click "Join by Code"
2. Nháº­p code: "A1B2C3"
3. Click "Join"

### Expected Results
- âœ… User Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n WaitingRoom
- âœ… User KHÃ”NG pháº£i host (khÃ´ng cÃ³ nÃºt host controls)
- âœ… Player list hiá»ƒn thá»‹ táº¥t cáº£ members
- âœ… Host nháº­n notification: "ğŸ‘¤ [Name] joined the room"
- âœ… Táº¥t cáº£ members nháº­n `NTF_PLAYER_LIST` updated

### Backend Logs
```
[SERVER] [JOIN_ROOM] âœ… SUCCESS: player X joined room Y
[ROOM] Broadcast cmd=0x02bc to room=Y (N recipients)
[ROOM] Broadcasting player list for room Y
```

---

## ğŸ“‹ TEST CASE 2B: JOIN ROOM FROM ROOM LIST

### Má»¥c tiÃªu
Verify user cÃ³ thá»ƒ join phÃ²ng tá»« danh sÃ¡ch phÃ²ng cÃ´ng khai

### Preconditions
- CÃ³ Ã­t nháº¥t 1 public room trong lobby
- User Ä‘Ã£ Ä‘Äƒng nháº­p, Ä‘ang á»Ÿ Lobby

### Steps
1. Xem danh sÃ¡ch rooms trong Lobby
2. Click vÃ o room card "Test Room"
3. Click "Join"

### Expected Results
- âœ… User Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n WaitingRoom
- âœ… Room info hiá»ƒn thá»‹ Ä‘Ãºng (name, code, rules)
- âœ… Player list hiá»ƒn thá»‹ táº¥t cáº£ members
- âœ… Host vÃ  members khÃ¡c nháº­n `NTF_PLAYER_JOINED` vÃ  `NTF_PLAYER_LIST`

### Backend Logs
```
[SERVER] [JOIN_ROOM] âœ… SUCCESS: player X joined room Y
[ROOM] Broadcast cmd=0x02bc to room=Y (N recipients)
```

---

## ğŸ“‹ TEST CASE 2C: JOIN PRIVATE ROOM

### Má»¥c tiÃªu
Verify user cÃ³ thá»ƒ join phÃ²ng private báº±ng code (khÃ´ng hiá»ƒn thá»‹ trong list)

### Preconditions
- Room private Ä‘Ã£ tá»“n táº¡i (code: "X1Y2Z3", visibility: Private)
- User Ä‘Ã£ Ä‘Äƒng nháº­p, Ä‘ang á»Ÿ Lobby

### Steps
1. Kiá»ƒm tra room list â†’ KHÃ”NG tháº¥y room "X1Y2Z3"
2. Click "Join by Code"
3. Nháº­p code: "X1Y2Z3"
4. Click "Join"

### Expected Results
- âœ… Room KHÃ”NG hiá»ƒn thá»‹ trong public room list
- âœ… User váº«n join Ä‘Æ°á»£c báº±ng code
- âœ… Táº¥t cáº£ expected results giá»‘ng TC2A

### Backend Logs
```
[SERVER] [JOIN_ROOM] âœ… SUCCESS: player X joined private room Y
```

---

## ğŸ“‹ TEST CASE 3: READY/UNREADY

### Má»¥c tiÃªu
Verify player cÃ³ thá»ƒ toggle ready state

### Preconditions
- User Ä‘Ã£ join room
- User KHÃ”NG pháº£i host

### Steps
1. Click button "Ready"
2. Äá»£i 2 giÃ¢y
3. Click button "Unready"

### Expected Results
**Sau bÆ°á»›c 1:**
- âœ… Button Ä‘á»•i thÃ nh "Unready" (mÃ u xanh)
- âœ… Player card hiá»ƒn thá»‹ badge "READY"
- âœ… Táº¥t cáº£ members nháº­n `NTF_PLAYER_READY`: `{"account_id": X, "is_ready": true}`

**Sau bÆ°á»›c 3:**
- âœ… Button Ä‘á»•i láº¡i thÃ nh "Ready"
- âœ… Badge "READY" biáº¿n máº¥t
- âœ… Táº¥t cáº£ members nháº­n `NTF_PLAYER_READY`: `{"account_id": X, "is_ready": false}`

### Backend Logs
```
[Ready] âœ… SUCCESS: room_id=X, account_id=Y, is_ready=true
[Ready] âœ… SUCCESS: room_id=X, account_id=Y, is_ready=false
```

---

## ğŸ“‹ TEST CASE 4: SET GAME RULES (HOST ONLY)

### Má»¥c tiÃªu
Verify host cÃ³ thá»ƒ thay Ä‘á»•i game rules

### Preconditions
- User lÃ  host
- Room cÃ³ Ã­t nháº¥t 2 players
- Má»™t sá»‘ players Ä‘Ã£ ready

### Steps
1. Click "Edit Rules"
2. Thay Ä‘á»•i: Mode=Elimination, Max Players=4, Visibility=Private
3. Click "Save"

### Expected Results
- âœ… Rules Ä‘Æ°á»£c update
- âœ… Táº¤T Cáº¢ players' ready state reset vá» `false`
- âœ… Táº¥t cáº£ members nháº­n `NTF_RULES_CHANGED`
- âœ… Táº¥t cáº£ members nháº­n `NTF_PLAYER_LIST` vá»›i ready states reset
- âœ… UI hiá»ƒn thá»‹ rules má»›i

### Backend Logs
```
[SetGameRule] Resetting ready states for N players
[SetGameRule] âœ… DB sync successful
[SetGameRule] âœ… SUCCESS: room_id=X, all players notified
```

---

## ğŸ“‹ TEST CASE 5: KICK MEMBER (HOST ONLY)

### Má»¥c tiÃªu
Verify host cÃ³ thá»ƒ kick member khá»i phÃ²ng

### Preconditions
- User A lÃ  host
- User B, C Ä‘Ã£ join room
- Room status = WAITING

### Steps
1. Host (User A) click nÃºt "Kick" trÃªn card cá»§a User B
2. Confirm dialog

### Expected Results

**User A (Host):**
- âœ… Nháº­n alert: "âœ… ÄÃ£ kick thÃ nh cÃ´ng!"
- âœ… Player list tá»± Ä‘á»™ng cáº­p nháº­t (User B biáº¿n máº¥t)

**User B (Kicked):**
- âœ… Nháº­n alert: "âš ï¸ Báº¡n Ä‘Ã£ bá»‹ kick khá»i phÃ²ng!"
- âœ… Tá»± Ä‘á»™ng navigate vá» Lobby

**User C (Remaining):**
- âœ… Nháº­n alert: "âš ï¸ d2 Ä‘Ã£ bá»‹ kick khá»i phÃ²ng" (vá»›i tÃªn Ä‘Ãºng)
- âœ… Player list tá»± Ä‘á»™ng cáº­p nháº­t

### Backend Logs
```
[Kick Member] ===== BEFORE STATE =====
[Kick Member] [RoomState] Player Count: 3
[Kick Member] âœ… Removed player X from in-memory state
[Kick Member] ===== AFTER STATE =====
[Kick Member] [RoomState] Player Count: 2
[Kick Member] Sent RES_MEMBER_KICKED to host
[Kick Member] Sent NTF_MEMBER_KICKED to target
[Kick Member] Broadcasting NTF_PLAYER_LEFT: {"account_id":X,"reason":"kicked"}
[Kick Member] âœ… SUCCESS
```

---

## ğŸ“‹ TEST CASE 6: LEAVE ROOM (SELF)

### Má»¥c tiÃªu
Verify player cÃ³ thá»ƒ tá»± rá»i phÃ²ng

### Preconditions
- User Ä‘Ã£ join room
- User KHÃ”NG pháº£i host

### Steps
1. Click button "Leave Room"
2. Confirm dialog

### Expected Results

**User (Leaver):**
- âœ… Navigate vá» Lobby
- âœ… Session state = LOBBY

**Remaining Players:**
- âœ… Nháº­n alert: "ğŸ‘‹ [Name] Ä‘Ã£ rá»i phÃ²ng"
- âœ… Player list tá»± Ä‘á»™ng cáº­p nháº­t

### Backend Logs
```
[Leave Room] ===== BEFORE STATE =====
[Leave Room] Leaver: X (was_host=NO)
[Leave Room] âœ… Removed player X from in-memory state
[Leave Room] Broadcasting NTF_PLAYER_LEFT: {"account_id":X,"reason":"left"}
[Leave Room] âœ… SUCCESS
```

---

## ğŸ“‹ TEST CASE 7: HOST LEAVE â†’ AUTO TRANSFER

### Má»¥c tiÃªu
Verify khi host rá»i phÃ²ng, host Ä‘Æ°á»£c transfer tá»± Ä‘á»™ng

### Preconditions
- User A lÃ  host
- User B, C Ä‘Ã£ join room

### Steps
1. User A (host) click "Leave Room"
2. Confirm

### Expected Results

**User A (Old Host):**
- âœ… Navigate vá» Lobby

**User B (New Host - player Ä‘áº§u tiÃªn cÃ²n láº¡i):**
- âœ… Nháº­n alert: "ğŸ‰ Báº¡n Ä‘Ã£ trá»Ÿ thÃ nh host má»›i!"
- âœ… UI hiá»ƒn thá»‹ host controls (Start Game, Edit Rules, Kick buttons)
- âœ… Player card cÃ³ badge "HOST"

**User C (Remaining Member):**
- âœ… Nháº­n alert: "ğŸ‘‹ d1 Ä‘Ã£ rá»i phÃ²ng"
- âœ… Nháº­n alert: "ğŸ”„ Host Ä‘Ã£ thay Ä‘á»•i!"
- âœ… Player list updated: User B cÃ³ badge "HOST"

### Backend Logs
```
[Leave Room] Leaver: X (was_host=YES)
[Leave Room] New host assigned: Y
[Leave Room] Broadcasting NTF_HOST_CHANGED: {"new_host_id":Y}
[Leave Room] âœ… SUCCESS
```

---

## ğŸ“‹ TEST CASE 8: ROOM FULL

### Má»¥c tiÃªu
Verify khÃ´ng thá»ƒ join phÃ²ng Ä‘Ã£ Ä‘áº§y

### Preconditions
- Room cÃ³ max_players=4
- Room Ä‘Ã£ cÃ³ 4 players

### Steps
1. User E cá»‘ gáº¯ng join room

### Expected Results
- âœ… Nháº­n error: "Room is full"
- âœ… KhÃ´ng Ä‘Æ°á»£c join
- âœ… Váº«n á»Ÿ Lobby

### Backend Logs
```
[SERVER] [JOIN_ROOM] Error: Room full (elimination mode, 4/4)
```

---

## ğŸ“‹ TEST CASE 9: KICK DURING GAME (SHOULD FAIL)

### Má»¥c tiÃªu
Verify khÃ´ng thá»ƒ kick khi game Ä‘ang chÆ¡i

### Preconditions
- Room status = PLAYING

### Steps
1. Host click "Kick" trÃªn member

### Expected Results
- âœ… Nháº­n error: "Cannot kick during game"
- âœ… Member khÃ´ng bá»‹ kick

### Backend Logs
```
[Kick Member] âŒ ERROR: Cannot kick during game
```


---

## ğŸ¯ PRIORITY TEST MATRIX

| Priority | Test Case | Critical? |
|----------|-----------|-----------|
| P0 | TC1: CREATE ROOM | âœ… YES |
| P0 | TC2A: JOIN BY CODE | âœ… YES |
| P0 | TC2B: JOIN FROM LIST | âœ… YES |
| P1 | TC2C: JOIN PRIVATE | NO |
| P0 | TC6: LEAVE ROOM | âœ… YES |
| P0 | TC7: HOST TRANSFER | âœ… YES |
| P1 | TC5: KICK MEMBER | âœ… YES |
| P1 | TC3: READY/UNREADY | âœ… YES |
| P1 | TC4: SET RULES | âœ… YES |
| P2 | TC8: ROOM FULL | NO |
| P2 | TC9: KICK DURING GAME | NO |

---

## ğŸ“ TESTING CHECKLIST

### Before Testing
- [ ] Backend server running
- [ ] Frontend running
- [ ] Database clean (no zombie rooms)
- [ ] At least 3 test accounts ready

### During Testing
- [ ] Check browser console for errors
- [ ] Check backend logs for each operation
- [ ] Verify all notifications received
- [ ] Verify UI updates correctly

### After Testing
- [ ] Document any bugs found
- [ ] Verify all P0 tests pass
- [ ] Create bug tickets for failures

---

## ğŸ› KNOWN ISSUES

*(To be filled during testing)*

---

## âœ… TEST RESULTS

*(To be filled after testing)*

| Test Case | Status | Notes |
|-----------|--------|-------|
| TC1: Create Room | â³ | |
| TC2A: Join by Code | â³ | |
| TC2B: Join from List | â³ | |
| TC2C: Join Private | â³ | |
| TC3: Ready/Unready | â³ | |
| TC4: Set Rules | â³ | |
| TC5: Kick Member | â³ | |
| TC6: Leave Room | â³ | |
| TC7: Host Transfer | â³ | |
| TC8: Room Full | â³ | |
| TC9: Kick During Game | â³ | |
| TC10: Non-Host Kick | â³ | |
