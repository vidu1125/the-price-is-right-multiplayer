
**Workflow**

**FRONTEND**

* Frontend UI â†’ Frontend Service
* Gá»­i **JSON request** xuá»‘ng C Server
* Nháº­n **JSON response** tá»« C Server

---

**C SERVER**

* **Transport**

  * Nháº­n dá»¯ liá»‡u dáº¡ng **raw bytes**
* **Protocol**

  * Nháº­n raw bytes tá»« Transport
  * **Parse message**
* **Handler**

  * Xá»­ lÃ½ logic sau khi message Ä‘Æ°á»£c parse
* Forward request sang Backend
* Nháº­n response tá»« Backend

---

**BACKEND**

* Nháº­n request tá»« C Server
* Giao tiáº¿p hai chiá»u vá»›i Database

---

**DATABASE**

* LÆ°u trá»¯ vÃ  truy xuáº¥t dá»¯ liá»‡u
* Tráº£ dá»¯ liá»‡u vá» Backend

---

**Luá»“ng tá»•ng quÃ¡t:**

Frontend UI
â†’ Frontend Service
â†’ (JSON request)
â†’ C Server (Transport â†’ Protocol â†’ Handler)
â†’ Backend
â†” Database
â†’ Backend
â†’ C Server
â†’ (JSON response)
â†’ Frontend Service
â†’ Frontend UI

---

**NETWORK worktree**
Network/
â”œâ”€ include/
â”‚  â”œâ”€ protocol/                 ğŸ”’ CHUNG â€“ API & CONTRACT
â”‚  â”‚  â”œâ”€ protocol.h
â”‚  â”‚  â”‚   # magic, version, header size, limits
â”‚  â”‚  â””â”€ opcode.h
â”‚  â”‚      # opcode (REQ/RESP/ERRORâ€¦)
â”‚  â”‚
â”‚  â”œâ”€ transport/                ğŸ”’ CHUNG â€“ Socket interface
â”‚  â”‚  â””â”€ socket_server.h
â”‚  â”‚      # accept/recv/send API
â”‚  â”‚
â”‚  â””â”€ handlers/                 ğŸ”’ CHUNG â€“ Dispatcher + handler interfaces
â”‚     â”œâ”€ dispatcher.h
â”‚     â”‚   # map opcode â†’ handler
â”‚     â”œâ”€ room_handler.h         âœ³ RIÃŠNG â€“ Dev A
â”‚     â”œâ”€ match_handler.h        âœ³ RIÃŠNG â€“ Dev B
â”‚     â”œâ”€ profile_handler.h      âœ³ RIÃŠNG â€“ Dev C
â”‚     â””â”€ history_handler.h      âœ³ RIÃŠNG â€“ (ai phá»¥ trÃ¡ch history)
â”‚
â”œâ”€ src/
â”‚  â”œâ”€ protocol/                 ğŸ”’ CHUNG â€“ Encode/Decode
â”‚  â”‚  â””â”€ message.c
â”‚  â”‚      # parse/pack header + payload
â”‚  â”‚
â”‚  â”œâ”€ transport/                ğŸ”’ CHUNG â€“ Socket core
â”‚  â”‚  â””â”€ socket_server.c
â”‚  â”‚      # recv â†’ decode â†’ dispatch â†’ send
â”‚  â”‚
â”‚  â””â”€ handlers/
â”‚     â”œâ”€ dispatcher.c           ğŸ”’ CHUNG â€“ Ä‘iá»u phá»‘i opcode (KHÃ”NG business)
â”‚     â”œâ”€ room_handler.c         âœ³ RIÃŠNG â€“ Dev A
â”‚     â”œâ”€ match_handler.c        âœ³ RIÃŠNG â€“ Dev B
â”‚     â”œâ”€ profile_handler.c      âœ³ RIÃŠNG â€“ Dev C
â”‚     â””â”€ history_handler.c      âœ³ RIÃŠNG â€“ (ai phá»¥ trÃ¡ch history)
â”‚
â”œâ”€ main.c                       ğŸ”’ CHUNG â€“ Entry point server
â”œâ”€ Dockerfile                   ğŸ”’ CI â€“ Build & run
â””â”€ Makefile                     ğŸ”’ CHUNG â€“ Build C project

Note:

Chá»‰ thÃªm code vÃ o handlers

Name convention

TÃªn file: <domain>_handler.c vÃ  <domain>_handler.h

TÃªn hÃ m xá»­ lÃ½:

handle_<domain>(
    int client_fd,
    MessageHeader *req,
    const char *payload
)


Import opcode tá»« protocols/opcode.h, khÃ´ng tá»± define láº¡i opcode
(Náº¿u cáº§n thÃªm opcode, pháº£i thÃ´ng bÃ¡o vá»›i má»i ngÆ°á»i Ä‘á»ƒ trÃ¡nh conflict mÃ£ opcode)

Import protocol.h Ä‘á»ƒ define header

**FRONTEND worktree**

Frontend/
â”œâ”€ public/                      ğŸ”’ CHUNG â€“ static assets
â”‚
â”œâ”€ src/
â”‚  â”œâ”€ components/               âœ³ RIÃŠNG â€“ UI theo domain
â”‚  â”‚  â”œâ”€ Lobby/                 # Dev A â€“ mÃ n hÃ¬nh lobby
â”‚  â”‚  â”œâ”€ Room/                  # Dev A â€“ phÃ²ng chÆ¡i
â”‚  â”‚  â”œâ”€ Game/                  # Dev B â€“ gameplay
â”‚  â”‚  â””â”€ RoomOld/               # legacy / refactor (náº¿u cÃ²n dÃ¹ng)
â”‚  â”‚
â”‚  â”œâ”€ network/                  ğŸ”’ CHUNG â€“ socket core (KHÃ”NG business)
â”‚  â”‚  â”œâ”€ socketClient.js        # WS connect / send / recv raw bytes
â”‚  â”‚  â”œâ”€ receiver.js            # decode frame â†’ emit event
â”‚  â”‚  â””â”€ dispatcher.js          # opcode â†’ service handler
â”‚  â”‚
â”‚  â”œâ”€ services/                 âœ³ RIÃŠNG â€“ business logic theo domain
â”‚  â”‚  â”œâ”€ historyService.js      # Dev D â€“ history
â”‚  â”‚  â”œâ”€ roomService.js         # Dev A â€“ room / lobby
â”‚  â”‚  â””â”€ socketServices.js      # (náº¿u cÃ³) wrapper tiá»‡n Ã­ch
â”‚  â”‚
â”‚  â”œâ”€ App.js                    ğŸ”’ CHUNG â€“ root component
â”‚  â”œâ”€ App.css
â”‚  â”œâ”€ index.js                  ğŸ”’ CHUNG â€“ entry point
â”‚  â””â”€ index.css
â”‚
â”œâ”€ .env                         ğŸ”’ CHUNG â€“ env config
â”œâ”€ Dockerfile                   ğŸ”’ CHUNG â€“ build frontend
â”œâ”€ package.json                 ğŸ”’ CHUNG â€“ deps & scripts
â””â”€ README.md                    ğŸ”’ CHUNG â€“ Æ°á»›c frontend

Note:

Chá»‰ thÃªm code service vÃ o thÆ° má»¥c services Ä‘á»ƒ define action

KHÃ”NG thÃªm function vÃ o components
(components chá»‰ gá»i cÃ¡c hÃ nh Ä‘á»™ng Ä‘Æ°á»£c expose tá»« service)

Name convention:
services/<domain>Service.js



**BACKEND worktre**

Backend/
â”œâ”€ app/
â”‚  â”œâ”€ routes/                   âœ³ RIÃŠNG â€“ chia theo dev / domain
â”‚  â”‚  â”œâ”€ __init__.py             ğŸ”’ CHUNG â€“ auto register
â”‚  â”‚  â”œâ”€ room_routes.py          âœ³ Dev A
â”‚  â”‚  â”œâ”€ match_routes.py         âœ³ Dev B
â”‚  â”‚  â””â”€ history_routes.py       âœ³ Dev C
â”‚  â”‚
â”‚  â”œâ”€ services/                 ğŸ”’ CHUNG â€“ business logic
â”‚  â”‚  â”œâ”€ room_service.py
â”‚  â”‚  â”œâ”€ match_service.py
â”‚  â”‚  â””â”€ history_service.py
â”‚  â”‚
â”‚  â”œâ”€ models/
â”‚  â”‚  â””â”€ database.py
â”‚  â”‚
â”‚  â””â”€ main.py                   ğŸ”’ CHUNG â€“ entry point
â”‚
â”œâ”€ requirements.txt
â””â”€ Dockerfile


**Testing connection**
-          Frontend: kiá»ƒm tra console log
Connected to gateway                                  socketClient.js:10
[Service][History] viewHistory() called                historyService.js:10
[DISPATCH] send  { command: '502', payloadLen: 0 }     dispatcher.js:35
[Socket] recv                                         socketClient.js:14
Uint8Array(43) [
  67, 71, 1, 0, 5, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 27,
  10, 4, 105, 115, 116, 111, 114, 121, 32, 110, 111,
  116, 32, 105, 110, 32, 116, 105, 101, 108, 101, 109,
  101, 116, 101, 100
]
buffer: ArrayBuffer(43)
byteLength: 43
byteOffset: 0
length: 43
Symbol(Symbol.toStringTag): "Uint8Array"


-          Ws-bridge: docker compose logs -f ws-bridge

thowo@Thowo:~/networkprog/the-price-is-right-multiplayer$ docker compose logs -f ws-bridge

tpir-ws-bridge | ğŸŸ¢ WS Bridge listening on :8080
tpir-ws-bridge | ğŸ”— WS client connected
tpir-ws-bridge | ğŸ”Œ Connected to C server network:5500
tpir-ws-bridge | ğŸ“¤ WS -> TCP <Buffer 43 47 01 00 05 02 00 00 00 00 00 01 00 00 00 00>
tpir-ws-bridge | ğŸ“¥ TCP -> WS FRAME { command: '0x502', seqNum: 1, length: 27 }
tpir-ws-bridge | tpir-ws-bridge exited with code 137
