
**Workflow**
Vá»›i má»—i usecase cáº§n:
-	Payload
-	Define state machine (náº¿u cáº§n)
-	Luá»“ng thÃ nh cÃ´ng (gá»­i response gÃ¬)
-	Error handling 
o	BÃ¡o lá»—i chung
o	Define lá»—i riÃªng


**NETWORK worktree**
Network/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ protocol/                 ğŸ”’ CHUNG - API & CONTRACT
â”‚   â”‚   â”œâ”€â”€ protocol.h
â”‚   â”‚   â””â”€â”€ opcode.h
â”‚   â”‚
â”‚   â”œâ”€â”€ transport/                ğŸ”’ CHUNG - Socket interface
â”‚   â”‚   â””â”€â”€ socket_server.h
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ dispatcher.h          ğŸ”’ CHUNG - opcode â†’ handler
â”‚   â”‚   â””â”€â”€ room_handler.h        ğŸŸ¢ RIÃŠNG - Dev A
â”‚   â”‚
â”‚   â””â”€â”€ db/
â”‚       â”œâ”€â”€ core/                 ğŸ”’ CHUNG - DB core
â”‚       â”‚   â””â”€â”€ db_client.h
â”‚       â”‚
â”‚       â”œâ”€â”€ models/               ğŸ”’ CHUNG - READ ONLY
â”‚       â”‚   â””â”€â”€ room_model.h      # vÃ­ dá»¥ 1 model
â”‚       â”‚
â”‚       â””â”€â”€ repo/                 ğŸŸ¢ RIÃŠNG - domain repo
â”‚           â””â”€â”€ room_repo.h       # vÃ­ dá»¥ 1 repo
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ protocol/
â”‚   â”‚   â””â”€â”€ message.c             ğŸ”’ CHUNG - encode/decode
â”‚   â”‚
â”‚   â”œâ”€â”€ transport/
â”‚   â”‚   â””â”€â”€ socket_server.c       ğŸ”’ CHUNG - socket core
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ dispatcher.c          ğŸ”’ CHUNG - KHÃ”NG business
â”‚   â”‚   â””â”€â”€ room_handler.c        ğŸŸ¢ RIÃŠNG - Dev A
â”‚   â”‚
â”‚   â””â”€â”€ db/
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â””â”€â”€ db_client.c       ğŸ”’ CHUNG
â”‚       â”‚
â”‚       â””â”€â”€ repo/
â”‚           â””â”€â”€ room_repo.c       ğŸŸ¢ RIÃŠNG
â”‚
â”œâ”€â”€ main.c                        ğŸ”’ CHUNG - entry point
â”œâ”€â”€ Dockerfile                   ğŸ”’ CHUNG

Note:
-	Chá»‰ thÃªm code vÃ o handlers
-	Name convention:
TÃªn file: <domain>_handler.c vÃ  <domain>_handler.h
TÃªn hÃ m xá»­ lÃ½: handle_<domain>(int client_fd, MessageHeader *req, const char *payload)
-	Import opcode tá»« protocols/opcode.h, khÃ´ng tá»± define láº¡i opcode (Náº¿u cáº§n thÃªm opcode ïƒ  cáº§n thÃ´ng bÃ¡o vá»›i má»i ngÆ°á»i (trÃ¡nh conflit mÃ£ opcode))
-	Import protocol.h Ä‘á»ƒ define header
-	Má»i thay Ä‘á»•i cá»§a cÃ¡c hÃ m, logic chung ïƒ  cáº§n thÃ´ng bÃ¡o
-	Sá»­a query database á»Ÿ db/repo
<usecase>_repo.c (NÃªn check vá»›i cÃ¡c usecase tÆ°Æ¡ng tá»± trÃ¡nh láº·p code)
â€¢	Gá»i db_get / db_post
â€¢	Parse cJSON â†’ room_t
â€¢	Validate logic DB-level
â€¢	KhÃ´ng xá»­ lÃ½ game logic
-	Model.h lÃ  dÃ¹ng Ä‘á»ƒ chuáº©n hÃ³a dá»¯ liá»‡u ïƒ  khÃ´ng tá»± typdef dá»¯ liá»‡u má»›i trong repo


**FRONTEND worktree**
Frontend/
â”œâ”€â”€ public/                       ğŸ”’ CHUNG - static assets
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/               ğŸŸ¢ RIÃŠNG - UI theo domain
â”‚   â”‚   â”œâ”€â”€ Lobby/                # Dev A - mÃ n hÃ¬nh lobby
â”‚   â”‚   â”œâ”€â”€ Room/                 # Dev A - phÃ²ng chÆ¡i
â”‚   â”‚   â”œâ”€â”€ Game/                 # Dev B - gameplay
â”‚   â”‚   â””â”€â”€ RoomOld/              # legacy / refactor (náº¿u cÃ²n dÃ¹ng)
â”‚   â”‚
â”‚   â”œâ”€â”€ network/                  ğŸ”’ CHUNG - socket core (KHÃ”NG business)
â”‚   â”‚   â”œâ”€â”€ socketClient.js       # WS connect / send / recv raw bytes
â”‚   â”‚   â”œâ”€â”€ receiver.js           # decode frame â†’ emit event
â”‚   â”‚   â””â”€â”€ dispatcher.js         # opcode â†’ service handler
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 ğŸŸ¢ RIÃŠNG - business logic theo domain
â”‚   â”‚   â”œâ”€â”€ historyService.js     # Dev D - history
â”‚   â”‚   â”œâ”€â”€ roomService.js        # Dev A - room/lobby
â”‚   â”‚   â””â”€â”€ socketServices.js     # (náº¿u cÃ³) wrapper tiá»‡n Ã­ch
â”‚   â”‚
â”‚   â”œâ”€â”€ App.js                    ğŸ”’ CHUNG - root component
â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ index.js                  ğŸ”’ CHUNG - entry point
â”‚   â””â”€â”€ index.css
â”‚
â”œâ”€â”€ .env                          ğŸ”’ CHUNG - env config
â”œâ”€â”€ Dockerfile                    ğŸ”’ CHUNG - build frontend
â”œâ”€â”€ package.json                  ğŸ”’ CHUNG - deps & scripts
â””â”€â”€ README.md                     ğŸ”’ CHUNG - docs frontend

Note:
-	Chir thÃªm code service vÃ o thÆ° má»¥c services Ä‘á» define action, khÃ´ng thÃªm function vÃ o components (components chá»‰ gá»i Ä‘áº¿n hoáº¡t Ä‘á»™ng á»Ÿ service)
-	Name convention:
services/<domain>Service.js
  

**Äá»‹nh nghÄ©a 1 communicaton giá»¯a client vÃ  server**
CSS (Communication Stack / Conceptual Stack)

5. Use case / Semantics     â† "User muá»‘n lÃ m gÃ¬?"
4. Payload / Data           â† "Gá»­i cÃ¡i gÃ¬?"
3. Protocol                 â† "Gá»­i theo format nÃ o?"
2. Transport                â† "Gá»­i báº±ng cÃ¡ch nÃ o?"
1. Connection               â† "Ai Ä‘ang nÃ³i chuyá»‡n?"



**Testing connection**
-	Frontend: kiá»ƒm tra console log
Connected to gateway
[Service][History] viewHistory() called
[DISPATCH] send {
  command: '502',
  payloadLen: 0
}

[Socket] recv
Uint8Array(43) [
  67, 71, 1, 0, 5, 2, 0, 0, 0, 0, 1, 0, 0, 27,
  104, 105, 115, 116, 111, 114, 121, 32, 110, 111, 116, 32, 102, 111,
  108, 108, 111, 119, 101, 100, 32, 121, 101, 116
]
byteLength: 43
byteOffset: 0
length: 43
Symbol(Symbol.toStringTag): "Uint8Array"


-	Network: docker compose logs -f network
 NETWORK SOCKET SERVER START
===========================

Press Ctrl+C to stop

Socket server started on port 5500
Socket server started on port 5500
[DISPATCH] cmd=0x502 len=0
[HIST] handle history request
[HIST] response sent

Received shutdown signal, stopping server...
Socket server shutdown
Server stopped gracefully

tpr-network exited with code 0

-	Ws-bridge: docker compose logs -f ws-bridge
WS Bridge listening on :8080
WS client connected
Connected to C server network:5500
WS TCP buffer 43 07 e1 05 02 00 00 00 00 00 01 00 00 1b 68 69 73 74 6f 72 79 20 6e 6f 74 20 66 6f 6c 6c 6f 77 65 64 20 79 65 74
WS FRAME { cmd: 0x502, seqNum: 1, length: 27 }

tpr-ws-bridge exited with code 137



- Terminal command convention:
+ Network: [HANDLER] <usecase> infor
vd: [HANDLER] <viewHistory> this is command
+ Frontend: [SERVICE] <usecase> infor
vd: [SERVICE] <viewHistory> this is service